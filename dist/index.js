!function(t){var e={};function i(s){if(e[s])return e[s].exports;var r=e[s]={i:s,l:!1,exports:{}};return t[s].call(r.exports,r,r.exports,i),r.l=!0,r.exports}i.m=t,i.c=e,i.d=function(t,e,s){i.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:s})},i.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},i.t=function(t,e){if(1&e&&(t=i(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var s=Object.create(null);if(i.r(s),Object.defineProperty(s,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var r in t)i.d(s,r,function(e){return t[e]}.bind(null,r));return s},i.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return i.d(e,"a",e),e},i.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},i.p="",i(i.s=1)}([function(t,e,i){"use strict";e.__esModule=!0,e.updateListChildElements=e.getEl=void 0,e.getEl=function(t){return document.querySelector(t)};e.updateListChildElements=function(t,i){if(t&&i){var s=e.getEl(t),r=i.map((function(t){return function(t){var e=t.content,i=t.priority,s=t.isDone;return'\n        <div class="item" id="'+t.getId()+'">\n            <div class="is-done '+(s?"--ok":"")+'"></div>\n            <span class="content">'+e+'</span>\n            <span class="priority">('+i[0]+')</span>\n            <span class="remove">삭제</span>\n        </div>\n    '}(t)})).join("");s.innerHTML="",s.innerHTML=r}}},function(t,e,i){"use strict";e.__esModule=!0;var s=i(2),r=i(3),o=new s.Store("todolisttypescriptstoreid");new r.Controller(o).initialize()},function(t,e,i){"use strict";e.__esModule=!0,e.Store=void 0;var s=i(0),r=function(){function t(t){this.id="",this.progressList=[],this.doneList=[],this.inputPriority="medium",this.id=t}return t.prototype.setId=function(t){this.id=t},t.prototype.getId=function(){return this.id},t.prototype.getProgressItem=function(t){return this.progressList.find((function(e){return e.getId()===t}))},t.prototype.getDoneItem=function(t){return this.doneList.find((function(e){return e.getId()===t}))},t.prototype.getProgressList=function(){return this.progressList},t.prototype.getDoneList=function(){return this.doneList},t.prototype.addProgressItem=function(t){if(t)return t.isDone=!1,this.progressList.push(t),this.progressList.sort((function(t,e){return e.getDate()-t.getDate()})),s.updateListChildElements(".in-progress",this.progressList),t},t.prototype.addDoneItem=function(t){if(t)return t.isDone=!0,this.doneList.push(t),this.doneList.sort((function(t,e){return e.getDate()-t.getDate()})),s.updateListChildElements(".done",this.doneList),t},t.prototype.moveProgressToDone=function(t){var e=this.getProgressItem(t);if(e)return this.addDoneItem(e),this.removeProgressItem(t),e},t.prototype.moveDoneToProgress=function(t){var e=this.getDoneItem(t);if(e)return this.addProgressItem(e),this.removeDoneItem(t),e},t.prototype.removeProgressItem=function(t){var e=this.progressList.findIndex((function(e){return e.getId()===t}));if(-1!==e)return this.progressList.splice(e,1),s.updateListChildElements(".in-progress",this.progressList),this.progressList},t.prototype.removeDoneItem=function(t){var e=this.doneList.findIndex((function(e){return e.getId()===t}));if(-1!==e)return this.doneList.splice(e,1),s.updateListChildElements(".done",this.doneList),this.doneList},t.prototype.clearProgressList=function(){this.progressList=[],s.updateListChildElements(".in-progress",this.progressList)},t.prototype.clearDoneList=function(){this.doneList=[],s.updateListChildElements(".done",this.doneList)},t.prototype.getStoreJsonData=function(){var t={id:this.id,progressList:this.progressList.map((function(t){return t.getObjectData()})),doneList:this.doneList.map((function(t){return t.getObjectData()}))};return JSON.stringify(t)},t}();e.Store=r},function(t,e,i){"use strict";e.__esModule=!0,e.Controller=void 0;var s=i(4),r=i(0),o=function(){function t(t){this.store=null,this.progressIdList=[],this.doneIdList=[],this.store=t}return t.prototype.initialize=function(){var t,e;if(this.store){null===(t=r.getEl(".input-button"))||void 0===t||t.addEventListener("click",this.clickAddItemEventHandler.bind(this),!1),null===(e=r.getEl(".priority-buttons"))||void 0===e||e.addEventListener("click",this.clickPriorityEventHandler.bind(this),!0);var i=this.store.getProgressList(),s=this.store.getDoneList();i&&i.length&&(this.progressIdList=this.getListToIdList(i)),s&&s.length&&(this.doneIdList=this.getListToIdList(s)),this.registerListEvent(this.progressIdList),this.registerListEvent(this.doneIdList),r.getEl(".json-button.import").addEventListener("click",this.clickJsonImportEventHandler.bind(this),!1),r.getEl(".json-button.export").addEventListener("click",this.clickJsonExportEventHandler.bind(this),!1)}else console.error("this.store is null!")},t.prototype.getNewId=function(){return"id-"+Date.now()},t.prototype.getListToIdList=function(t){return t.map((function(t){return t.getId()}))},t.prototype.registerItemEvent=function(t){var e=r.getEl("#"+t).children;console.log(e),e[0].addEventListener("click",this.clickToggleDoneEventHandler.bind(this),!1),e[3].addEventListener("click",this.clickRemoveEventHandler.bind(this),!1)},t.prototype.registerListEvent=function(t){var e=this;t.forEach((function(t){e.registerItemEvent(t)}))},t.prototype.clickToggleDoneEventHandler=function(t){console.log(t);var e=t.target.parentElement.id;this.progressIdList.includes(e)?this.store.moveProgressToDone(e):this.doneIdList.includes(e)&&this.store.moveDoneToProgress(e),this.progressIdList=this.getListToIdList(this.store.getProgressList()),this.registerListEvent(this.progressIdList),this.doneIdList=this.getListToIdList(this.store.getDoneList()),this.registerListEvent(this.doneIdList)},t.prototype.clickRemoveEventHandler=function(t){console.log(t);var e=t.target.parentElement.id;console.log(e),this.progressIdList.includes(e)?(this.store.removeProgressItem(e),this.progressIdList=this.getListToIdList(this.store.getProgressList()),this.registerListEvent(this.progressIdList)):this.doneIdList.includes(e)&&(this.store.removeDoneItem(e),this.doneIdList=this.getListToIdList(this.store.getDoneList()),this.registerListEvent(this.doneIdList))},t.prototype.clickAddItemEventHandler=function(t){console.log(t);var e=r.getEl(".item-input"),i=e.value;if(i){var o=this.getNewId();this.store.addProgressItem(new s.Item(i,this.store.inputPriority,o,Date.now())),this.progressIdList=this.getListToIdList(this.store.getProgressList()),this.registerListEvent(this.progressIdList),e.value="",console.log(this.store)}},t.prototype.clickPriorityEventHandler=function(t){console.log(t);var e=t.target,i=e.parentElement,s=e.classList[0];if("high"===s||"medium"===s||"low"===s){this.store.inputPriority=s;var r=0;r="high"===s?3:"medium"===s?2:1,i.children[0].className="low",i.children[1].className="medium",i.children[2].className="high";for(var o=0;o<r;o++)i.children[o].className+=" --selected"}},t.prototype.clickJsonImportEventHandler=function(t){var e=this;console.log(t);var i=r.getEl(".json-text-area"),o=JSON.parse(i.value);this.store.setId(o.id),this.store.clearProgressList(),this.store.clearDoneList(),o.progressList.forEach((function(t){var i=t.content,r=t.priority,o=t.isDone;e.store.addProgressItem(new s.Item(i,r,t.id,t.date,o))})),o.doneList.forEach((function(t){var i=t.content,r=t.priority,o=t.isDone;e.store.addDoneItem(new s.Item(i,r,t.id,t.date,o))})),this.progressIdList=this.getListToIdList(this.store.getProgressList()),this.registerListEvent(this.progressIdList),this.doneIdList=this.getListToIdList(this.store.getDoneList()),this.registerListEvent(this.doneIdList)},t.prototype.clickJsonExportEventHandler=function(t){console.log(t),r.getEl(".json-text-area").value=this.store.getStoreJsonData()},t}();e.Controller=o},function(t,e,i){"use strict";e.__esModule=!0,e.Item=void 0;var s=function(){function t(t,e,i,s,r){this.content="",this.priority="medium",this.isDone=!1,this.date=0,this.id="",this.content=t,this.priority=e,this.id=i,this.date=s,this.isDone=r}return t.prototype.getDate=function(){return this.date},t.prototype.getId=function(){return this.id},t.prototype.getObjectData=function(){return{content:this.content,priority:this.priority,isDone:this.isDone,date:this.date,id:this.id}},t}();e.Item=s}]);
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly8vd2VicGFjay9ib290c3RyYXAiLCJ3ZWJwYWNrOi8vLy4vc3JjL3RzL3V0aWxzL3ZpZXcudHMiLCJ3ZWJwYWNrOi8vLy4vc3JjL2luZGV4LnRzIiwid2VicGFjazovLy8uL3NyYy90cy9TdG9yZS50cyIsIndlYnBhY2s6Ly8vLi9zcmMvdHMvQ29udHJvbGxlci50cyIsIndlYnBhY2s6Ly8vLi9zcmMvdHMvSXRlbS50cyJdLCJuYW1lcyI6WyJpbnN0YWxsZWRNb2R1bGVzIiwiX193ZWJwYWNrX3JlcXVpcmVfXyIsIm1vZHVsZUlkIiwiZXhwb3J0cyIsIm1vZHVsZSIsImkiLCJsIiwibW9kdWxlcyIsImNhbGwiLCJtIiwiYyIsImQiLCJuYW1lIiwiZ2V0dGVyIiwibyIsIk9iamVjdCIsImRlZmluZVByb3BlcnR5IiwiZW51bWVyYWJsZSIsImdldCIsInIiLCJTeW1ib2wiLCJ0b1N0cmluZ1RhZyIsInZhbHVlIiwidCIsIm1vZGUiLCJfX2VzTW9kdWxlIiwibnMiLCJjcmVhdGUiLCJrZXkiLCJiaW5kIiwibiIsIm9iamVjdCIsInByb3BlcnR5IiwicHJvdG90eXBlIiwiaGFzT3duUHJvcGVydHkiLCJwIiwicyIsImdldEVsIiwic2VsZWN0b3JzIiwiZG9jdW1lbnQiLCJxdWVyeVNlbGVjdG9yIiwidXBkYXRlTGlzdENoaWxkRWxlbWVudHMiLCJzZWxlY3RvciIsImxpc3QiLCJ3cmFwRWxlbWVudCIsIml0ZW1FbGVtZW50cyIsIm1hcCIsIml0ZW0iLCJjb250ZW50IiwicHJpb3JpdHkiLCJpc0RvbmUiLCJnZXRJZCIsImNyZWF0ZUl0ZW1FbGVtZW50Iiwiam9pbiIsImlubmVySFRNTCIsInN0b3JlIiwiU3RvcmUiLCJDb250cm9sbGVyIiwiaW5pdGlhbGl6ZSIsImlkIiwicHJvZ3Jlc3NMaXN0IiwiZG9uZUxpc3QiLCJpbnB1dFByaW9yaXR5IiwidGhpcyIsInNldElkIiwiZ2V0UHJvZ3Jlc3NJdGVtIiwiZmluZCIsImVsIiwiZ2V0RG9uZUl0ZW0iLCJnZXRQcm9ncmVzc0xpc3QiLCJnZXREb25lTGlzdCIsImFkZFByb2dyZXNzSXRlbSIsInB1c2giLCJzb3J0IiwiYSIsImIiLCJnZXREYXRlIiwiYWRkRG9uZUl0ZW0iLCJtb3ZlUHJvZ3Jlc3NUb0RvbmUiLCJyZW1vdmVQcm9ncmVzc0l0ZW0iLCJtb3ZlRG9uZVRvUHJvZ3Jlc3MiLCJyZW1vdmVEb25lSXRlbSIsInRhcmdldElkeCIsImZpbmRJbmRleCIsInNwbGljZSIsImNsZWFyUHJvZ3Jlc3NMaXN0IiwiY2xlYXJEb25lTGlzdCIsImdldFN0b3JlSnNvbkRhdGEiLCJvYmoiLCJnZXRPYmplY3REYXRhIiwiSlNPTiIsInN0cmluZ2lmeSIsInByb2dyZXNzSWRMaXN0IiwiZG9uZUlkTGlzdCIsImFkZEV2ZW50TGlzdGVuZXIiLCJjbGlja0FkZEl0ZW1FdmVudEhhbmRsZXIiLCJjbGlja1ByaW9yaXR5RXZlbnRIYW5kbGVyIiwibGVuZ3RoIiwiZ2V0TGlzdFRvSWRMaXN0IiwicmVnaXN0ZXJMaXN0RXZlbnQiLCJjbGlja0pzb25JbXBvcnRFdmVudEhhbmRsZXIiLCJjbGlja0pzb25FeHBvcnRFdmVudEhhbmRsZXIiLCJjb25zb2xlIiwiZXJyb3IiLCJnZXROZXdJZCIsIkRhdGUiLCJub3ciLCJyZWdpc3Rlckl0ZW1FdmVudCIsImNoaWxkTm9kZXNMaXN0IiwiY2hpbGRyZW4iLCJsb2ciLCJjbGlja1RvZ2dsZURvbmVFdmVudEhhbmRsZXIiLCJjbGlja1JlbW92ZUV2ZW50SGFuZGxlciIsImlkTGlzdCIsImZvckVhY2giLCJlIiwiaXRlbUlkIiwidGFyZ2V0IiwicGFyZW50RWxlbWVudCIsImluY2x1ZGVzIiwiaW5wdXRFbCIsIml0ZW1Db250ZW50IiwiSXRlbSIsInRhcmdldEVsIiwicGFyZW50RWwiLCJwcmlvcml0eVZhbHVlIiwiY2xhc3NMaXN0Iiwic2VsZWN0ZWRJZHhOdW0iLCJjbGFzc05hbWUiLCJ0ZXh0QXJlYUVsIiwiaW1wb3J0RGF0YXMiLCJwYXJzZSIsImRhdGUiXSwibWFwcGlu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RWhCLFlBQUE4QixjQUFBLFdBQ0ksTUFBTyxDQUNIekMsUUFBU2UsS0FBS2YsUUFDZEMsU0FBVWMsS0FBS2QsU0FDZkMsT0FBUWEsS0FBS2IsT0FDYmtGLEtBQU1yRSxLQUFLcUUsS0FDWHpFLEdBQUlJLEtBQUtKLEtBR3JCLEVBOUJBLEdBQWEsRUFBQStEIiwiZmlsZSI6ImluZGV4LmpzIiwic291cmNlc0NvbnRlbnQiOlsiIFx0Ly8gVGhlIG1vZHVsZSBjYWNoZVxuIFx0dmFyIGluc3RhbGxlZE1vZHVsZXMgPSB7fTtcblxuIFx0Ly8gVGhlIHJlcXVpcmUgZnVuY3Rpb25cbiBcdGZ1bmN0aW9uIF9fd2VicGFja19yZXF1aXJlX18obW9kdWxlSWQpIHtcblxuIFx0XHQvLyBDaGVjayBpZiBtb2R1bGUgaXMgaW4gY2FjaGVcbiBcdFx0aWYoaW5zdGFsbGVkTW9kdWxlc1ttb2R1bGVJZF0pIHtcbiBcdFx0XHRyZXR1cm4gaW5zdGFsbGVkTW9kdWxlc1ttb2R1bGVJZF0uZXhwb3J0cztcbiBcdFx0fVxuIFx0XHQvLyBDcmVhdGUgYSBuZXcgbW9kdWxlIChhbmQgcHV0IGl0IGludG8gdGhlIGNhY2hlKVxuIFx0XHR2YXIgbW9kdWxlID0gaW5zdGFsbGVkTW9kdWxlc1ttb2R1bGVJZF0gPSB7XG4gXHRcdFx0aTogbW9kdWxlSWQsXG4gXHRcdFx0bDogZmFsc2UsXG4gXHRcdFx0ZXhwb3J0czoge31cbiBcdFx0fTtcblxuIFx0XHQvLyBFeGVjdXRlIHRoZSBtb2R1bGUgZnVuY3Rpb25cbiBcdFx0bW9kdWxlc1ttb2R1bGVJZF0uY2FsbChtb2R1bGUuZXhwb3J0cywgbW9kdWxlLCBtb2R1bGUuZXhwb3J0cywgX193ZWJwYWNrX3JlcXVpcmVfXyk7XG5cbiBcdFx0Ly8gRmxhZyB0aGUgbW9kdWxlIGFzIGxvYWRlZFxuIFx0XHRtb2R1bGUubCA9IHRydWU7XG5cbiBcdFx0Ly8gUmV0dXJuIHRoZSBleHBvcnRzIG9mIHRoZSBtb2R1bGVcbiBcdFx0cmV0dXJuIG1vZHVsZS5leHBvcnRzO1xuIFx0fVxuXG5cbiBcdC8vIGV4cG9zZSB0aGUgbW9kdWxlcyBvYmplY3QgKF9fd2VicGFja19tb2R1bGVzX18pXG4gXHRfX3dlYnBhY2tfcmVxdWlyZV9fLm0gPSBtb2R1bGVzO1xuXG4gXHQvLyBleHBvc2UgdGhlIG1vZHVsZSBjYWNoZVxuIFx0X193ZWJwYWNrX3JlcXVpcmVfXy5jID0gaW5zdGFsbGVkTW9kdWxlcztcblxuIFx0Ly8gZGVmaW5lIGdldHRlciBmdW5jdGlvbiBmb3IgaGFybW9ueSBleHBvcnRzXG4gXHRfX3dlYnBhY2tfcmVxdWlyZV9fLmQgPSBmdW5jdGlvbihleHBvcnRzLCBuYW1lLCBnZXR0ZXIpIHtcbiBcdFx0aWYoIV9fd2VicGFja19yZXF1aXJlX18ubyhleHBvcnRzLCBuYW1lKSkge1xuIFx0XHRcdE9iamVjdC5kZWZpbmVQcm9wZXJ0eShleHBvcnRzLCBuYW1lLCB7IGVudW1lcmFibGU6IHRydWUsIGdldDogZ2V0dGVyIH0pO1xuIFx0XHR9XG4gXHR9O1xuXG4gXHQvLyBkZWZpbmUgX19lc01vZHVsZSBvbiBleHBvcnRzXG4gXHRfX3dlYnBhY2tfcmVxdWlyZV9fLnIgPSBmdW5jdGlvbihleHBvcnRzKSB7XG4gXHRcdGlmKHR5cGVvZiBTeW1ib2wgIT09ICd1bmRlZmluZWQnICYmIFN5bWJvbC50b1N0cmluZ1RhZykge1xuIFx0XHRcdE9iamVjdC5kZWZpbmVQcm9wZXJ0eShleHBvcnRzLCBTeW1ib2wudG9TdHJpbmdUYWcsIHsgdmFsdWU6ICdNb2R1bGUnIH0pO1xuIFx0XHR9XG4gXHRcdE9iamVjdC5kZWZpbmVQcm9wZXJ0eShleHBvcnRzLCAnX19lc01vZHVsZScsIHsgdmFsdWU6IHRydWUgfSk7XG4gXHR9O1xuXG4gXHQvLyBjcmVhdGUgYSBmYWtlIG5hbWVzcGFjZSBvYmplY3RcbiBcdC8vIG1vZGUgJiAxOiB2YWx1ZSBpcyBhIG1vZHVsZSBpZCwgcmVxdWlyZSBpdFxuIFx0Ly8gbW9kZSAmIDI6IG1lcmdlIGFsbCBwcm9wZXJ0aWVzIG9mIHZhbHVlIGludG8gdGhlIG5zXG4gXHQvLyBtb2RlICYgNDogcmV0dXJuIHZhbHVlIHdoZW4gYWxyZWFkeSBucyBvYmplY3RcbiBcdC8vIG1vZGUgJiA4fDE6IGJlaGF2ZSBsaWtlIHJlcXVpcmVcbiBcdF9fd2VicGFja19yZXF1aXJlX18udCA9IGZ1bmN0aW9uKHZhbHVlLCBtb2RlKSB7XG4gXHRcdGlmKG1vZGUgJiAxKSB2YWx1ZSA9IF9fd2VicGFja19yZXF1aXJlX18odmFsdWUpO1xuIFx0XHRpZihtb2RlICYgOCkgcmV0dXJuIHZhbHVlO1xuIFx0XHRpZigobW9kZSAmIDQpICYmIHR5cGVvZiB2YWx1ZSA9PT0gJ29iamVjdCcgJiYgdmFsdWUgJiYgdmFsdWUuX19lc01vZHVsZSkgcmV0dXJuIHZhbHVlO1xuIFx0XHR2YXIgbnMgPSBPYmplY3QuY3JlYXRlKG51bGwpO1xuIFx0XHRfX3dlYnBhY2tfcmVxdWlyZV9fLnIobnMpO1xuIFx0XHRPYmplY3QuZGVmaW5lUHJvcGVydHkobnMsICdkZWZhdWx0JywgeyBlbnVtZXJhYmxlOiB0cnVlLCB2YWx1ZTogdmFsdWUgfSk7XG4gXHRcdGlmKG1vZGUgJiAyICYmIHR5cGVvZiB2YWx1ZSAhPSAnc3RyaW5nJykgZm9yKHZhciBrZXkgaW4gdmFsdWUpIF9fd2VicGFja19yZXF1aXJlX18uZChucywga2V5LCBmdW5jdGlvbihrZXkpIHsgcmV0dXJuIHZhbHVlW2tleV07IH0uYmluZChudWxsLCBrZXkpKTtcbiBcdFx0cmV0dXJuIG5zO1xuIFx0fTtcblxuIFx0Ly8gZ2V0RGVmYXVsdEV4cG9ydCBmdW5jdGlvbiBmb3IgY29tcGF0aWJpbGl0eSB3aXRoIG5vbi1oYXJtb255IG1vZHVsZXNcbiBcdF9fd2VicGFja19yZXF1aXJlX18ubiA9IGZ1bmN0aW9uKG1vZHVsZSkge1xuIFx0XHR2YXIgZ2V0dGVyID0gbW9kdWxlICYmIG1vZHVsZS5fX2VzTW9kdWxlID9cbiBcdFx0XHRmdW5jdGlvbiBnZXREZWZhdWx0KCkgeyByZXR1cm4gbW9kdWxlWydkZWZhdWx0J107IH0gOlxuIFx0XHRcdGZ1bmN0aW9uIGdldE1vZHVsZUV4cG9ydHMoKSB7IHJldHVybiBtb2R1bGU7IH07XG4gXHRcdF9fd2VicGFja19yZXF1aXJlX18uZChnZXR0ZXIsICdhJywgZ2V0dGVyKTtcbiBcdFx0cmV0dXJuIGdldHRlcjtcbiBcdH07XG5cbiBcdC8vIE9iamVjdC5wcm90b3R5cGUuaGFzT3duUHJvcGVydHkuY2FsbFxuIFx0X193ZWJwYWNrX3JlcXVpcmVfXy5vID0gZnVuY3Rpb24ob2JqZWN0LCBwcm9wZXJ0eSkgeyByZXR1cm4gT2JqZWN0LnByb3RvdHlwZS5oYXNPd25Qcm9wZXJ0eS5jYWxsKG9iamVjdCwgcHJvcGVydHkpOyB9O1xuXG4gXHQvLyBfX3dlYnBhY2tfcHVibGljX3BhdGhfX1xuIFx0X193ZWJwYWNrX3JlcXVpcmVfXy5wID0gXCJcIjtcblxuXG4gXHQvLyBMb2FkIGVudHJ5IG1vZHVsZSBhbmQgcmV0dXJuIGV4cG9ydHNcbiBcdHJldHVybiBfX3dlYnBhY2tfcmVxdWlyZV9fKF9fd2VicGFja19yZXF1aXJlX18ucyA9IDEpO1xuIiwiaW1wb3J0IHsgSXRlbSB9IGZyb20gJy4uL0l0ZW0nO1xuXG5leHBvcnQgY29uc3QgZ2V0RWwgPSAoc2VsZWN0b3JzOnN0cmluZykgPT4ge1xuICAgIHJldHVybiBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKHNlbGVjdG9ycyk7XG59XG5cbi8vIGV4cG9ydCBjb25zdCBhZGRFdmVudCA9IChzZWxlY3RvcnM6c3RyaW5nLCB0eXBlOnN0cmluZywgY2FsbGJhY2s6RnVuY3Rpb24sIHVzZUNhcHR1cmU6Ym9vbGVhbikgPT4ge1xuLy8gICAgIGNvbnN0IHRhcmdldCA9IGdldEVsKHNlbGVjdG9ycyk7XG4vLyAgICAgaWYgKCF0YXJnZXQpIHtcbi8vICAgICAgICAgcmV0dXJuO1xuLy8gICAgIH1cbi8vICAgICByZXR1cm4gdGFyZ2V0LmFkZEV2ZW50TGlzdGVuZXIodHlwZSwgY2FsbGJhY2ssIHVzZUNhcHR1cmUpO1xuLy8gfVxuXG4vLyBleHBvcnQgY29uc3QgcmVtb3ZlRXZlbnQgPSAoc2VsZWN0b3JzOnN0cmluZywgdHlwZTpzdHJpbmcsIGNhbGxiYWNrOkZ1bmN0aW9uLCB1c2VDYXB0dXJlOmJvb2xlYW4pID0+IHtcbi8vICAgICByZXR1cm4gZ2V0RWwoc2VsZWN0b3JzKS5yZW1vdmVFdmVudExpc3RlbmVyKHR5cGUsIGNhbGxiYWNrLCB1c2VDYXB0dXJlKTtcbi8vIH1cblxuY29uc3QgY3JlYXRlSXRlbUVsZW1lbnQgPSAoaXRlbTpJdGVtKSA9PiB7XG4gICAgY29uc3QgeyBjb250ZW50LCBwcmlvcml0eSwgaXNEb25lIH0gPSBpdGVtO1xuICAgIGNvbnN0IGlkID0gaXRlbS5nZXRJZCgpO1xuICAgIGNvbnN0IGVsZW1lbnQgPSBgXG4gICAgICAgIDxkaXYgY2xhc3M9XCJpdGVtXCIgaWQ9XCIke2lkfVwiPlxuICAgICAgICAgICAgPGRpdiBjbGFzcz1cImlzLWRvbmUgJHtpc0RvbmUgPyAnLS1vaycgOiAnJ31cIj48L2Rpdj5cbiAgICAgICAgICAgIDxzcGFuIGNsYXNzPVwiY29udGVudFwiPiR7Y29udGVudH08L3NwYW4+XG4gICAgICAgICAgICA8c3BhbiBjbGFzcz1cInByaW9yaXR5XCI+KCR7cHJpb3JpdHlbMF19KTwvc3Bhbj5cbiAgICAgICAgICAgIDxzcGFuIGNsYXNzPVwicmVtb3ZlXCI+7IKt7KCcPC9zcGFuPlxuICAgICAgICA8L2Rpdj5cbiAgICBgXG5cbiAgICByZXR1cm4gZWxlbWVudDtcbn1cblxuZXhwb3J0IGNvbnN0IHVwZGF0ZUxpc3RDaGlsZEVsZW1lbnRzID0gKHNlbGVjdG9yOnN0cmluZywgbGlzdDpBcnJheTxJdGVtPikgPT4ge1xuICAgIGlmICghc2VsZWN0b3IgfHwgIWxpc3QpIHtcbiAgICAgICAgcmV0dXJuO1xuICAgIH1cbiAgICBjb25zdCB3cmFwRWxlbWVudCA9IGdldEVsKHNlbGVjdG9yKTtcbiAgICBjb25zdCBpdGVtRWxlbWVudHMgPSBsaXN0Lm1hcCgoaXRlbSkgPT4gY3JlYXRlSXRlbUVsZW1lbnQoaXRlbSkpLmpvaW4oJycpO1xuICAgIHdyYXBFbGVtZW50IS5pbm5lckhUTUwgPSAnJztcbiAgICB3cmFwRWxlbWVudCEuaW5uZXJIVE1MID0gaXRlbUVsZW1lbnRzO1xufSIsImltcG9ydCB7IFN0b3JlIH0gZnJvbSAnLi90cy9TdG9yZSc7XG5pbXBvcnQgeyBDb250cm9sbGVyIH0gZnJvbSAnLi90cy9Db250cm9sbGVyJztcblxuY29uc3Qgc3RvcmUgPSBuZXcgU3RvcmUoJ3RvZG9saXN0dHlwZXNjcmlwdHN0b3JlaWQnKTtcbmNvbnN0IGNvbnRyb2xsZXIgPSBuZXcgQ29udHJvbGxlcihzdG9yZSk7XG5cbmNvbnRyb2xsZXIuaW5pdGlhbGl6ZSgpOyIsImltcG9ydCB7IFByaW9yaXR5LCBJdGVtTGlzdCB9IGZyb20gJy4vY29uZmlnL3R5cGVzJztcbmltcG9ydCB7IEl0ZW0gfSBmcm9tICcuL0l0ZW0nO1xuaW1wb3J0IHsgdXBkYXRlTGlzdENoaWxkRWxlbWVudHMgfSBmcm9tICcuL3V0aWxzL3ZpZXcnO1xuXG5leHBvcnQgY2xhc3MgU3RvcmUge1xuICAgIHB1YmxpYyBjb25zdHJ1Y3RvcihpZDpzdHJpbmcpIHtcbiAgICAgICAgdGhpcy5pZCA9IGlkO1xuICAgIH1cblxuICAgIHByaXZhdGUgaWQ6c3RyaW5nID0gJyc7XG4gICAgcHJpdmF0ZSBwcm9ncmVzc0xpc3Q6SXRlbUxpc3QgPSBbXTtcbiAgICBwcml2YXRlIGRvbmVMaXN0Okl0ZW1MaXN0ID0gW107XG4gICAgcHVibGljIGlucHV0UHJpb3JpdHk6UHJpb3JpdHkgPSAnbWVkaXVtJztcblxuICAgIHB1YmxpYyBzZXRJZChpZDpzdHJpbmcpIHtcbiAgICAgICAgdGhpcy5pZCA9IGlkO1xuICAgIH1cbiAgICBwdWJsaWMgZ2V0SWQoKSB7XG4gICAgICAgIHJldHVybiB0aGlzLmlkO1xuICAgIH1cbiAgICBwdWJsaWMgZ2V0UHJvZ3Jlc3NJdGVtKGlkOnN0cmluZykge1xuICAgICAgICByZXR1cm4gdGhpcy5wcm9ncmVzc0xpc3QuZmluZChlbCA9PiBlbC5nZXRJZCgpID09PSBpZCk7XG4gICAgfVxuICAgIHB1YmxpYyBnZXREb25lSXRlbShpZDpzdHJpbmcpIHtcbiAgICAgICAgcmV0dXJuIHRoaXMuZG9uZUxpc3QuZmluZChlbCA9PiBlbC5nZXRJZCgpID09PSBpZCk7XG4gICAgfVxuICAgIHB1YmxpYyBnZXRQcm9ncmVzc0xpc3QoKSB7XG4gICAgICAgIHJldHVybiB0aGlzLnByb2dyZXNzTGlzdDtcbiAgICB9XG4gICAgcHVibGljIGdldERvbmVMaXN0KCkge1xuICAgICAgICByZXR1cm4gdGhpcy5kb25lTGlzdDtcbiAgICB9XG4gICAgcHVibGljIGFkZFByb2dyZXNzSXRlbShpdGVtOkl0ZW0pIHtcbiAgICAgICAgaWYgKCFpdGVtKSB7XG4gICAgICAgICAgICByZXR1cm47XG4gICAgICAgIH1cbiAgICAgICAgaXRlbS5pc0RvbmUgPSBmYWxzZTtcbiAgICAgICAgdGhpcy5wcm9ncmVzc0xpc3QucHVzaChpdGVtKTtcbiAgICAgICAgdGhpcy5wcm9ncmVzc0xpc3Quc29ydCgoYSwgYikgPT4gYi5nZXREYXRlKCkgLSBhLmdldERhdGUoKSk7XG5cbiAgICAgICAgdXBkYXRlTGlzdENoaWxkRWxlbWVudHMoJy5pbi1wcm9ncmVzcycsIHRoaXMucHJvZ3Jlc3NMaXN0KTtcblxuICAgICAgICByZXR1cm4gaXRlbTtcbiAgICB9XG4gICAgcHVibGljIGFkZERvbmVJdGVtKGl0ZW06SXRlbSkge1xuICAgICAgICBpZiAoIWl0ZW0pIHtcbiAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgfVxuICAgICAgICBpdGVtLmlzRG9uZSA9IHRydWU7XG4gICAgICAgIHRoaXMuZG9uZUxpc3QucHVzaChpdGVtKTtcbiAgICAgICAgdGhpcy5kb25lTGlzdC5zb3J0KChhLCBiKSA9PiBiLmdldERhdGUoKSAtIGEuZ2V0RGF0ZSgpKTtcblxuICAgICAgICB1cGRhdGVMaXN0Q2hpbGRFbGVtZW50cygnLmRvbmUnLCB0aGlzLmRvbmVMaXN0KTtcblxuICAgICAgICByZXR1cm4gaXRlbTtcbiAgICB9XG4gICAgcHVibGljIG1vdmVQcm9ncmVzc1RvRG9uZShpZDpzdHJpbmcpIHtcbiAgICAgICAgY29uc3QgaXRlbSA9IHRoaXMuZ2V0UHJvZ3Jlc3NJdGVtKGlkKTtcbiAgICAgICAgaWYgKCFpdGVtKSB7XG4gICAgICAgICAgICByZXR1cm47XG4gICAgICAgIH1cbiAgICAgICAgdGhpcy5hZGREb25lSXRlbShpdGVtKTtcbiAgICAgICAgdGhpcy5yZW1vdmVQcm9ncmVzc0l0ZW0oaWQpO1xuICAgICAgICBcbiAgICAgICAgcmV0dXJuIGl0ZW07XG4gICAgfSAgIFxuICAgIHB1YmxpYyBtb3ZlRG9uZVRvUHJvZ3Jlc3MoaWQ6c3RyaW5nKSB7XG4gICAgICAgIGNvbnN0IGl0ZW0gPSB0aGlzLmdldERvbmVJdGVtKGlkKTtcbiAgICAgICAgaWYgKCFpdGVtKSB7XG4gICAgICAgICAgICByZXR1cm47XG4gICAgICAgIH1cbiAgICAgICAgdGhpcy5hZGRQcm9ncmVzc0l0ZW0oaXRlbSk7XG4gICAgICAgIHRoaXMucmVtb3ZlRG9uZUl0ZW0oaWQpO1xuXG4gICAgICAgIHJldHVybiBpdGVtO1xuICAgIH1cbiAgICBwdWJsaWMgcmVtb3ZlUHJvZ3Jlc3NJdGVtKGlkOnN0cmluZykge1xuICAgICAgICBjb25zdCB0YXJnZXRJZHggPSB0aGlzLnByb2dyZXNzTGlzdC5maW5kSW5kZXgoZWwgPT4gZWwuZ2V0SWQoKSA9PT0gaWQpO1xuICAgICAgICBpZiAodGFyZ2V0SWR4ID09PSAtMSkge1xuICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICB9XG4gICAgICAgIHRoaXMucHJvZ3Jlc3NMaXN0LnNwbGljZSh0YXJnZXRJZHgsIDEpO1xuXG4gICAgICAgIHVwZGF0ZUxpc3RDaGlsZEVsZW1lbnRzKCcuaW4tcHJvZ3Jlc3MnLCB0aGlzLnByb2dyZXNzTGlzdCk7XG5cbiAgICAgICAgcmV0dXJuIHRoaXMucHJvZ3Jlc3NMaXN0O1xuICAgIH1cbiAgICBwdWJsaWMgcmVtb3ZlRG9uZUl0ZW0oaWQ6c3RyaW5nKSB7XG4gICAgICAgIGNvbnN0IHRhcmdldElkeCA9IHRoaXMuZG9uZUxpc3QuZmluZEluZGV4KGVsID0+IGVsLmdldElkKCkgPT09IGlkKTtcbiAgICAgICAgaWYgKHRhcmdldElkeCA9PT0gLTEpIHtcbiAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgfVxuICAgICAgICB0aGlzLmRvbmVMaXN0LnNwbGljZSh0YXJnZXRJZHgsIDEpO1xuICAgICAgICBcbiAgICAgICAgdXBkYXRlTGlzdENoaWxkRWxlbWVudHMoJy5kb25lJywgdGhpcy5kb25lTGlzdCk7XG5cbiAgICAgICAgcmV0dXJuIHRoaXMuZG9uZUxpc3Q7XG4gICAgfVxuICAgIHB1YmxpYyBjbGVhclByb2dyZXNzTGlzdCgpIHtcbiAgICAgICAgdGhpcy5wcm9ncmVzc0xpc3QgPSBbXTtcblxuICAgICAgICB1cGRhdGVMaXN0Q2hpbGRFbGVtZW50cygnLmluLXByb2dyZXNzJywgdGhpcy5wcm9ncmVzc0xpc3QpO1xuICAgIH1cbiAgICBwdWJsaWMgY2xlYXJEb25lTGlzdCgpIHtcbiAgICAgICAgdGhpcy5kb25lTGlzdCA9IFtdO1xuXG4gICAgICAgIHVwZGF0ZUxpc3RDaGlsZEVsZW1lbnRzKCcuZG9uZScsIHRoaXMuZG9uZUxpc3QpO1xuICAgIH1cbiAgICBwdWJsaWMgZ2V0U3RvcmVKc29uRGF0YSgpIHtcbiAgICAgICAgY29uc3Qgb2JqID0ge1xuICAgICAgICAgICAgaWQ6IHRoaXMuaWQsXG4gICAgICAgICAgICBwcm9ncmVzc0xpc3Q6IHRoaXMucHJvZ3Jlc3NMaXN0Lm1hcChpdGVtID0+IGl0ZW0uZ2V0T2JqZWN0RGF0YSgpKSxcbiAgICAgICAgICAgIGRvbmVMaXN0OiB0aGlzLmRvbmVMaXN0Lm1hcChpdGVtID0+IGl0ZW0uZ2V0T2JqZWN0RGF0YSgpKSxcbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gSlNPTi5zdHJpbmdpZnkob2JqKTtcbiAgICB9XG59IiwiaW1wb3J0IHsgUHJpb3JpdHksIElkTGlzdCB9IGZyb20gJy4vY29uZmlnL3R5cGVzJztcbmltcG9ydCB7IEl0ZW0gfSBmcm9tICcuL0l0ZW0nO1xuaW1wb3J0IHsgU3RvcmUgfSBmcm9tICcuL1N0b3JlJztcbmltcG9ydCB7IGdldEVsIH0gZnJvbSAnLi91dGlscy92aWV3JztcblxuZXhwb3J0IGNsYXNzIENvbnRyb2xsZXIge1xuICAgIHB1YmxpYyBjb25zdHJ1Y3RvcihzdG9yZTpTdG9yZSkge1xuICAgICAgICB0aGlzLnN0b3JlID0gc3RvcmU7XG4gICAgfVxuICAgIHByaXZhdGUgc3RvcmU6U3RvcmUgfCBudWxsID0gbnVsbDtcbiAgICBwcml2YXRlIHByb2dyZXNzSWRMaXN0OklkTGlzdCA9IFtdO1xuICAgIHByaXZhdGUgZG9uZUlkTGlzdDpJZExpc3QgPSBbXTtcblxuICAgIHB1YmxpYyBpbml0aWFsaXplKCkge1xuICAgICAgICBpZiAoIXRoaXMuc3RvcmUpIHtcbiAgICAgICAgICAgIGNvbnNvbGUuZXJyb3IoJ3RoaXMuc3RvcmUgaXMgbnVsbCEnKTtcbiAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgfVxuICAgICAgICBnZXRFbCgnLmlucHV0LWJ1dHRvbicpPy5hZGRFdmVudExpc3RlbmVyKCdjbGljaycsIHRoaXMuY2xpY2tBZGRJdGVtRXZlbnRIYW5kbGVyLmJpbmQodGhpcyksIGZhbHNlKTtcbiAgICAgICAgZ2V0RWwoJy5wcmlvcml0eS1idXR0b25zJyk/LmFkZEV2ZW50TGlzdGVuZXIoJ2NsaWNrJywgdGhpcy5jbGlja1ByaW9yaXR5RXZlbnRIYW5kbGVyLmJpbmQodGhpcyksIHRydWUpO1xuICAgICAgICBjb25zdCBwcm9ncmVzc0xpc3QgPSB0aGlzLnN0b3JlLmdldFByb2dyZXNzTGlzdCgpO1xuICAgICAgICBjb25zdCBkb25lTGlzdCA9IHRoaXMuc3RvcmUuZ2V0RG9uZUxpc3QoKTtcbiAgICAgICAgaWYgKHByb2dyZXNzTGlzdCAmJiBwcm9ncmVzc0xpc3QubGVuZ3RoKSB7XG4gICAgICAgICAgICB0aGlzLnByb2dyZXNzSWRMaXN0ID0gdGhpcy5nZXRMaXN0VG9JZExpc3QocHJvZ3Jlc3NMaXN0KTtcbiAgICAgICAgfVxuICAgICAgICBpZiAoZG9uZUxpc3QgJiYgZG9uZUxpc3QubGVuZ3RoKSB7XG4gICAgICAgICAgICB0aGlzLmRvbmVJZExpc3QgPSB0aGlzLmdldExpc3RUb0lkTGlzdChkb25lTGlzdCk7XG4gICAgICAgIH1cblxuICAgICAgICB0aGlzLnJlZ2lzdGVyTGlzdEV2ZW50KHRoaXMucHJvZ3Jlc3NJZExpc3QpO1xuICAgICAgICB0aGlzLnJlZ2lzdGVyTGlzdEV2ZW50KHRoaXMuZG9uZUlkTGlzdCk7XG5cbiAgICAgICAgZ2V0RWwoJy5qc29uLWJ1dHRvbi5pbXBvcnQnKS5hZGRFdmVudExpc3RlbmVyKCdjbGljaycsIHRoaXMuY2xpY2tKc29uSW1wb3J0RXZlbnRIYW5kbGVyLmJpbmQodGhpcyksIGZhbHNlKTtcbiAgICAgICAgZ2V0RWwoJy5qc29uLWJ1dHRvbi5leHBvcnQnKS5hZGRFdmVudExpc3RlbmVyKCdjbGljaycsIHRoaXMuY2xpY2tKc29uRXhwb3J0RXZlbnRIYW5kbGVyLmJpbmQodGhpcyksIGZhbHNlKTtcbiAgICB9XG4gICAgcHJpdmF0ZSBnZXROZXdJZCgpIHtcbiAgICAgICAgcmV0dXJuIGBpZC0ke0RhdGUubm93KCl9YDtcbiAgICB9XG4gICAgcHJpdmF0ZSBnZXRMaXN0VG9JZExpc3QobGlzdCkge1xuICAgICAgICByZXR1cm4gbGlzdC5tYXAoZWwgPT4gZWwuZ2V0SWQoKSk7XG4gICAgfVxuICAgIHByaXZhdGUgcmVnaXN0ZXJJdGVtRXZlbnQoaWQpIHtcbiAgICAgICAgY29uc3QgY2hpbGROb2Rlc0xpc3QgPSBnZXRFbChgIyR7aWR9YCkhLmNoaWxkcmVuO1xuICAgICAgICBjb25zb2xlLmxvZyhjaGlsZE5vZGVzTGlzdCk7XG4gICAgICAgIGNoaWxkTm9kZXNMaXN0WzBdLmFkZEV2ZW50TGlzdGVuZXIoJ2NsaWNrJywgdGhpcy5jbGlja1RvZ2dsZURvbmVFdmVudEhhbmRsZXIuYmluZCh0aGlzKSwgZmFsc2UpO1xuICAgICAgICBjaGlsZE5vZGVzTGlzdFszXS5hZGRFdmVudExpc3RlbmVyKCdjbGljaycsIHRoaXMuY2xpY2tSZW1vdmVFdmVudEhhbmRsZXIuYmluZCh0aGlzKSwgZmFsc2UpO1xuICAgIH1cbiAgICBwcml2YXRlIHJlZ2lzdGVyTGlzdEV2ZW50KGlkTGlzdDpJZExpc3QpIHtcbiAgICAgICAgaWRMaXN0LmZvckVhY2goaWQgPT4ge1xuICAgICAgICAgICAgdGhpcy5yZWdpc3Rlckl0ZW1FdmVudChpZCk7XG4gICAgICAgIH0pO1xuICAgIH1cbiAgICBwcml2YXRlIGNsaWNrVG9nZ2xlRG9uZUV2ZW50SGFuZGxlcihlOkV2ZW50KSB7XG4gICAgICAgIGNvbnNvbGUubG9nKGUpO1xuICAgICAgICBjb25zdCB0YXJnZXRFbCA9IGUudGFyZ2V0IGFzIEhUTUxFbGVtZW50O1xuICAgICAgICBjb25zdCBpdGVtSWQgPSB0YXJnZXRFbC5wYXJlbnRFbGVtZW50LmlkO1xuICAgICAgICBpZiAodGhpcy5wcm9ncmVzc0lkTGlzdC5pbmNsdWRlcyhpdGVtSWQpKSB7XG4gICAgICAgICAgICB0aGlzLnN0b3JlLm1vdmVQcm9ncmVzc1RvRG9uZShpdGVtSWQpO1xuICAgICAgICB9IGVsc2UgaWYgKHRoaXMuZG9uZUlkTGlzdC5pbmNsdWRlcyhpdGVtSWQpKSB7XG4gICAgICAgICAgICB0aGlzLnN0b3JlLm1vdmVEb25lVG9Qcm9ncmVzcyhpdGVtSWQpO1xuICAgICAgICB9XG4gICAgICAgIHRoaXMucHJvZ3Jlc3NJZExpc3QgPSB0aGlzLmdldExpc3RUb0lkTGlzdCh0aGlzLnN0b3JlLmdldFByb2dyZXNzTGlzdCgpKTtcbiAgICAgICAgdGhpcy5yZWdpc3Rlckxpc3RFdmVudCh0aGlzLnByb2dyZXNzSWRMaXN0KTtcbiAgICAgICAgdGhpcy5kb25lSWRMaXN0ID0gdGhpcy5nZXRMaXN0VG9JZExpc3QodGhpcy5zdG9yZS5nZXREb25lTGlzdCgpKTtcbiAgICAgICAgdGhpcy5yZWdpc3Rlckxpc3RFdmVudCh0aGlzLmRvbmVJZExpc3QpO1xuICAgIH1cbiAgICBwcml2YXRlIGNsaWNrUmVtb3ZlRXZlbnRIYW5kbGVyKGU6RXZlbnQpIHtcbiAgICAgICAgY29uc29sZS5sb2coZSk7XG4gICAgICAgIGNvbnN0IHRhcmdldEVsID0gZS50YXJnZXQgYXMgSFRNTEVsZW1lbnQ7XG4gICAgICAgIGNvbnN0IGl0ZW1JZCA9IHRhcmdldEVsLnBhcmVudEVsZW1lbnQuaWQ7XG4gICAgICAgIGNvbnNvbGUubG9nKGl0ZW1JZCk7XG4gICAgICAgIGlmICh0aGlzLnByb2dyZXNzSWRMaXN0LmluY2x1ZGVzKGl0ZW1JZCkpIHtcbiAgICAgICAgICAgIHRoaXMuc3RvcmUucmVtb3ZlUHJvZ3Jlc3NJdGVtKGl0ZW1JZCk7XG4gICAgICAgICAgICB0aGlzLnByb2dyZXNzSWRMaXN0ID0gdGhpcy5nZXRMaXN0VG9JZExpc3QodGhpcy5zdG9yZS5nZXRQcm9ncmVzc0xpc3QoKSk7XG4gICAgICAgICAgICB0aGlzLnJlZ2lzdGVyTGlzdEV2ZW50KHRoaXMucHJvZ3Jlc3NJZExpc3QpO1xuICAgICAgICB9IGVsc2UgaWYgKHRoaXMuZG9uZUlkTGlzdC5pbmNsdWRlcyhpdGVtSWQpKSB7XG4gICAgICAgICAgICB0aGlzLnN0b3JlLnJlbW92ZURvbmVJdGVtKGl0ZW1JZCk7XG4gICAgICAgICAgICB0aGlzLmRvbmVJZExpc3QgPSB0aGlzLmdldExpc3RUb0lkTGlzdCh0aGlzLnN0b3JlLmdldERvbmVMaXN0KCkpO1xuICAgICAgICAgICAgdGhpcy5yZWdpc3Rlckxpc3RFdmVudCh0aGlzLmRvbmVJZExpc3QpO1xuICAgICAgICB9XG4gICAgfVxuICAgIHByaXZhdGUgY2xpY2tBZGRJdGVtRXZlbnRIYW5kbGVyKGU6RXZlbnQpIHtcbiAgICAgICAgY29uc29sZS5sb2coZSk7XG4gICAgICAgIGNvbnN0IGlucHV0RWwgPSBnZXRFbCgnLml0ZW0taW5wdXQnKSBhcyBIVE1MSW5wdXRFbGVtZW50O1xuICAgICAgICBjb25zdCBpdGVtQ29udGVudCA9IGlucHV0RWwudmFsdWU7XG4gICAgICAgIGlmICghaXRlbUNvbnRlbnQpIHtcbiAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgfVxuICAgICAgICBjb25zdCBpZCA9IHRoaXMuZ2V0TmV3SWQoKTtcbiAgICAgICAgdGhpcy5zdG9yZS5hZGRQcm9ncmVzc0l0ZW0obmV3IEl0ZW0oaXRlbUNvbnRlbnQsIHRoaXMuc3RvcmUuaW5wdXRQcmlvcml0eSwgaWQsIERhdGUubm93KCkpKTtcbiAgICAgICAgdGhpcy5wcm9ncmVzc0lkTGlzdCA9IHRoaXMuZ2V0TGlzdFRvSWRMaXN0KHRoaXMuc3RvcmUuZ2V0UHJvZ3Jlc3NMaXN0KCkpO1xuICAgICAgICB0aGlzLnJlZ2lzdGVyTGlzdEV2ZW50KHRoaXMucHJvZ3Jlc3NJZExpc3QpO1xuICAgICAgICBpbnB1dEVsLnZhbHVlID0gJyc7XG4gICAgICAgIGNvbnNvbGUubG9nKHRoaXMuc3RvcmUpO1xuICAgIH1cbiAgICBwcml2YXRlIGNsaWNrUHJpb3JpdHlFdmVudEhhbmRsZXIoZTpFdmVudCkge1xuICAgICAgICBjb25zb2xlLmxvZyhlKTtcbiAgICAgICAgY29uc3QgdGFyZ2V0RWwgPSBlLnRhcmdldCBhcyBIVE1MRWxlbWVudDtcbiAgICAgICAgY29uc3QgcGFyZW50RWwgPSB0YXJnZXRFbC5wYXJlbnRFbGVtZW50IGFzIEhUTUxFbGVtZW50O1xuICAgICAgICBjb25zdCBwcmlvcml0eVZhbHVlID0gdGFyZ2V0RWwuY2xhc3NMaXN0WzBdXG4gICAgICAgIGlmIChwcmlvcml0eVZhbHVlICE9PSAnaGlnaCcgJiYgcHJpb3JpdHlWYWx1ZSAhPT0gJ21lZGl1bScgJiYgcHJpb3JpdHlWYWx1ZSAhPT0gJ2xvdycpIHtcbiAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgfVxuICAgICAgICB0aGlzLnN0b3JlLmlucHV0UHJpb3JpdHkgPSBwcmlvcml0eVZhbHVlIGFzIFByaW9yaXR5O1xuICAgICAgICBsZXQgc2VsZWN0ZWRJZHhOdW0gPSAwO1xuICAgICAgICBpZiAocHJpb3JpdHlWYWx1ZSA9PT0gJ2hpZ2gnKSB7XG4gICAgICAgICAgICBzZWxlY3RlZElkeE51bSA9IDM7XG4gICAgICAgIH0gZWxzZSBpZiAocHJpb3JpdHlWYWx1ZSA9PT0gJ21lZGl1bScpIHtcbiAgICAgICAgICAgIHNlbGVjdGVkSWR4TnVtID0gMjtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIHNlbGVjdGVkSWR4TnVtID0gMTtcbiAgICAgICAgfVxuICAgICAgICBwYXJlbnRFbC5jaGlsZHJlblswXS5jbGFzc05hbWUgPSAnbG93JztcbiAgICAgICAgcGFyZW50RWwuY2hpbGRyZW5bMV0uY2xhc3NOYW1lID0gJ21lZGl1bSc7XG4gICAgICAgIHBhcmVudEVsLmNoaWxkcmVuWzJdLmNsYXNzTmFtZSA9ICdoaWdoJztcbiAgICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCBzZWxlY3RlZElkeE51bTsgaSsrKSB7XG4gICAgICAgICAgICBwYXJlbnRFbC5jaGlsZHJlbltpXS5jbGFzc05hbWUgKz0gJyAtLXNlbGVjdGVkJztcbiAgICAgICAgfVxuICAgIH1cbiAgICBwcml2YXRlIGNsaWNrSnNvbkltcG9ydEV2ZW50SGFuZGxlcihlOkV2ZW50KSB7XG4gICAgICAgIGNvbnNvbGUubG9nKGUpO1xuICAgICAgICBjb25zdCB0ZXh0QXJlYUVsID0gZ2V0RWwoJy5qc29uLXRleHQtYXJlYScpIGFzIEhUTUxUZXh0QXJlYUVsZW1lbnQ7XG4gICAgICAgIGNvbnN0IGltcG9ydERhdGFzID0gSlNPTi5wYXJzZSh0ZXh0QXJlYUVsLnZhbHVlKTtcbiAgICAgICAgdGhpcy5zdG9yZS5zZXRJZChpbXBvcnREYXRhcy5pZCk7XG5cbiAgICAgICAgdGhpcy5zdG9yZS5jbGVhclByb2dyZXNzTGlzdCgpO1xuICAgICAgICB0aGlzLnN0b3JlLmNsZWFyRG9uZUxpc3QoKTtcblxuICAgICAgICBpbXBvcnREYXRhcy5wcm9ncmVzc0xpc3QuZm9yRWFjaChpdGVtID0+IHtcbiAgICAgICAgICAgIGNvbnN0IHsgY29udGVudCwgcHJpb3JpdHksIGlzRG9uZSB9ID0gaXRlbTtcbiAgICAgICAgICAgIHRoaXMuc3RvcmUuYWRkUHJvZ3Jlc3NJdGVtKG5ldyBJdGVtKGNvbnRlbnQsIHByaW9yaXR5LCBpdGVtLmlkLCBpdGVtLmRhdGUsIGlzRG9uZSkpO1xuICAgICAgICB9KVxuICAgICAgICBpbXBvcnREYXRhcy5kb25lTGlzdC5mb3JFYWNoKGl0ZW0gPT4ge1xuICAgICAgICAgICAgY29uc3QgeyBjb250ZW50LCBwcmlvcml0eSwgaXNEb25lfSA9IGl0ZW07XG4gICAgICAgICAgICB0aGlzLnN0b3JlLmFkZERvbmVJdGVtKG5ldyBJdGVtKGNvbnRlbnQsIHByaW9yaXR5LCBpdGVtLmlkLCBpdGVtLmRhdGUsIGlzRG9uZSkpXG4gICAgICAgIH0pXG4gICAgICAgIHRoaXMucHJvZ3Jlc3NJZExpc3QgPSB0aGlzLmdldExpc3RUb0lkTGlzdCh0aGlzLnN0b3JlLmdldFByb2dyZXNzTGlzdCgpKTtcbiAgICAgICAgdGhpcy5yZWdpc3Rlckxpc3RFdmVudCh0aGlzLnByb2dyZXNzSWRMaXN0KTtcbiAgICAgICAgdGhpcy5kb25lSWRMaXN0ID0gdGhpcy5nZXRMaXN0VG9JZExpc3QodGhpcy5zdG9yZS5nZXREb25lTGlzdCgpKTtcbiAgICAgICAgdGhpcy5yZWdpc3Rlckxpc3RFdmVudCh0aGlzLmRvbmVJZExpc3QpO1xuICAgIH1cbiAgICBwcml2YXRlIGNsaWNrSnNvbkV4cG9ydEV2ZW50SGFuZGxlcihlOkV2ZW50KSB7XG4gICAgICAgIGNvbnNvbGUubG9nKGUpO1xuICAgICAgICBjb25zdCB0ZXh0QXJlYUVsID0gZ2V0RWwoJy5qc29uLXRleHQtYXJlYScpIGFzIEhUTUxUZXh0QXJlYUVsZW1lbnQ7XG4gICAgICAgIHRleHRBcmVhRWwudmFsdWUgPSB0aGlzLnN0b3JlLmdldFN0b3JlSnNvbkRhdGEoKTtcbiAgICB9XG59IiwiaW1wb3J0IHsgUHJpb3JpdHkgfSBmcm9tICcuL2NvbmZpZy90eXBlcyc7XG5cbmV4cG9ydCBjbGFzcyBJdGVtIHtcbiAgICBwdWJsaWMgY29uc3RydWN0b3IoY29udGVudCwgcHJpb3JpdHksIGlkLCBkYXRlLCBpc0RvbmU/KSB7XG4gICAgICAgIHRoaXMuY29udGVudCA9IGNvbnRlbnQ7XG4gICAgICAgIHRoaXMucHJpb3JpdHkgPSBwcmlvcml0eTtcbiAgICAgICAgdGhpcy5pZCA9IGlkO1xuICAgICAgICB0aGlzLmRhdGUgPSBkYXRlO1xuICAgICAgICB0aGlzLmlzRG9uZSA9IGlzRG9uZTtcbiAgICB9XG5cbiAgICBwdWJsaWMgY29udGVudDpzdHJpbmcgPSAnJztcbiAgICBwdWJsaWMgcHJpb3JpdHk6UHJpb3JpdHkgPSAnbWVkaXVtJztcbiAgICBwdWJsaWMgaXNEb25lOmJvb2xlYW4gPSBmYWxzZTtcbiAgICBwcml2YXRlIGRhdGU6bnVtYmVyID0gMDtcbiAgICBwcml2YXRlIGlkOnN0cmluZyA9ICcnO1xuXG4gICAgZ2V0RGF0ZSgpIHtcbiAgICAgICAgcmV0dXJuIHRoaXMuZGF0ZTtcbiAgICB9XG4gICAgZ2V0SWQoKSB7XG4gICAgICAgIHJldHVybiB0aGlzLmlkO1xuICAgIH1cbiAgICBnZXRPYmplY3REYXRhKCkge1xuICAgICAgICByZXR1cm4ge1xuICAgICAgICAgICAgY29udGVudDogdGhpcy5jb250ZW50LFxuICAgICAgICAgICAgcHJpb3JpdHk6IHRoaXMucHJpb3JpdHksXG4gICAgICAgICAgICBpc0RvbmU6IHRoaXMuaXNEb25lLFxuICAgICAgICAgICAgZGF0ZTogdGhpcy5kYXRlLFxuICAgICAgICAgICAgaWQ6IHRoaXMuaWRcbiAgICAgICAgfTtcbiAgICB9XG59Il0sInNvdXJjZVJvb3QiOiIifQ==